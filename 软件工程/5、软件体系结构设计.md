# 设计体系结构

将系统**分解**为规模可管理的单元

## 设计

客户及相应的开发人员，会经常在最初的需求分析完成后适当地修改需求

**体系结构风格：** 软件体系结构一般性的解决方案

**设计模式 design pattern**：是一种针对单个软件模块或少量模块而给出的一般性解决方案，它提供相对较低层次的设计决策

**设计公约 design convention/idiom**：是一系列设计决策和建议的集合，采用这些设计决策和建议，能够提高系统某方面的设计质量

**创新设计：**基于基本的*设计原则*，创造全新的解决方案；与**例程设计**（评估更加严格、困难，且评估侧重于专家评估而不是客观标准，不太准确）相反

每个计划用来描述体系结构的一个方面或**视图**

## 体系结构建模

使用体系结构模型的方式有以下6种：

- 理解系统：它将做什么，以及如何做
- 确定该系统的哪部分将**复用**前面已经构建的系统中的元素，以及系统哪些部分将会被复用
- 展示构建系统的蓝图，包括系统可能的”承重”部分
- 推测系统将会如何演变，包括性能、成本以及原型开发的问题
- 分析依赖关系，选择合适的设计、实现和测试技术
- 为管理决策提供支持，了解实现和维护时系统固有的风险

## 分解

“自顶向下”的方法

- 功能性分解（根据功能或需求）
- 面向特征的设计（为每个模块指定了各自的特征）
  - 高层：描述了具有某个服务和特征集的系统
  - 低层：描述了各个特征如何扩展服务，以及确定特征之间如何进行交互
- 面向数据的分解
  - 高层：概念上的数据结构
  - 低层：提供细节
- 面向进程的分解
  - 高层：确定系统的主要任务，为进程指派任务；解释任务之间是如何协调工作的
  - 低层：过程的实现细节
- 面向事件的分解
  - 高层：将系统预期的输入编成目录
  - 低层：将系统分解为状态，并描述事件是如何触发状态转移的
- 面向对象的设计
  - 高层：定义了系统对象的类型，解释了对象之间是如何关联的
  - 低层：细化了对象的属性和操作

## 视图

不仅可以展示构件间如何交互，而且能够描述这个系统的分布，或者它能够展示系统提供的所有服务以及这些服务间如何协调操作的视图

体系结构视图一般包括：

- 分解视图
  - 将系统描述为若干个可编程的单元
- 依赖视图
  - 展示了软件单元之间的依赖关系
- 泛化视图
  - 展示了一个软件单元是否是另一个单元的泛化或特化
- 执行视图
  - 方框-箭头图
  - 构件可能会拥有自己的程序栈
  - 连接器是一种构件之间的通信机制
- 实现视图
  - 代码单元和源文件之间建立映射
- 部署视图
  - 运行时实体和计算机资源之间建立映射
- 工作分配视图
  - 将系统分解成可以分配给各项目团队的工作任务

## 体系结构风格和策略

体系结构风格是已建立的、大规模的系统结构模式

可以组合，有若干种组合方式：

- 在系统分解的不同级别使用不同的风格
- 体系结构可以使用一个混合的风格来为不同的构件或者构件间不同类型的交互建模
- 当体系结构风格之间可以互相兼容时，风格的集成将会更加容易

### 管道和过滤器

管道不对数据进行处理，只是简单地将数据从一个过滤器到另一个过滤器；每个过滤器都是独立的

### 客户-服务器

服务器提供服务；客户通过**请求/应答协议**访问服务

**回调callback**：客户向服务器发送一个可执行的函数

支持构件重用

### 对等网络

*peer to peer, P2P*

规模已扩展，但增加了系统的容量，对故障具有较好的容错性

每个构件本身既是客户端又是服务端

适合于文件是静态的、文件内容和性质并不是关键、共享速度和可靠性不是很重要的时候

### 发布-订阅

构件对其他构件的存在一无所知

**隐含调用：** 订阅者将自己的某个过程与感兴趣的事件建立关联

不利于单独测试，若需要共享固定不变的数据增加的信息库会减弱系统的可扩展性和可复用性

不影响其他的构件，轻松复用

### 信息库

*repository*

由中心数据存储以及与其相关联的访问构件组成

对系统关键数据的中心式的管理

**黑板：** 知识源（数据存取器）

### 分层

只可以访问同层中的其他单元和相邻低层的接口所提供的服务；但是有时也会跨越（层次桥接）

*在任何情况下任何层都不能访问它上面的层次*

## 质量属性的策略*tatic*

### 可修改性

策略：

- 预测预期改变
- 高内聚性
- 低耦合
- 通用性
- 通过接口进行交互
- 多重接口

### 性能

描述了系统速度和容量上的特点，包括：

- 响应时间：对请求的反应有多迅速
- 吞吐量：每分钟可以处理多少请求
- 负载：在响应时间和吞吐量变糟糕之前，可以支持多少用户使用

策略：

- 提高资源的利用率（并行、复制以及分布共享数据）
- 有效地管理资源分配
- 降低对资源的需求

### 安全性

策略：

- 能够阻挡**攻击**企图，就是具有高**免疫力**的；
  - 在设计中保证包含了所有的安全性特征
  - 将可能被攻击者利用的安全性弱点最小化
- 能够快速容易地从成功的**攻击**中恢复，就是具有高**弹性**的
  - 把功能分段，这样攻击造成的影响只会存在于系统的很小一部分之中
  - 使系统能够在一小段时间里快速恢复功能和性能

### 可靠性

如果一个软件系统可以在假设的环境下正确地实现所要求的功能，则称这个软件系统是**可靠的**

如果在”不正确的输入或意外的环境条件下”还能正常地工作，则称它是**健壮的**

**故障：** 不可见的错误，只有开发人员可以看到的错误

**失效：** 可见的错误，是客户和用户所看到的问题

*不是每个故障都会引起失效*

策略：

- 主动故障检测
  - 加入异常处理
  - 加入某种形式的冗余
    - n版本编程：如果两个功能相同的系统是由两个不同团队、在不同时间、使用不同的技术开发而成，那么这两种实现出现同样的故障的几率十分小
- 故障恢复
  - 需要立即处理，减少破坏性
  - 随时做好恢复的准备的同时也会带来额外的开销
  - 撤销事务
  - 检验点/回退
  - 备份
  - 服务降级
  - 修正和继续
  - 报告

### 健壮性

**互相怀疑策略：** 每个软件单元都假设其他软件单元中含有故障

策略与可靠性相同，但是健壮性的问题来源在于软件环境中，而不是软件本身之中

### 易使用性

策略：

- 用户界面需要放置于自己的软件单元中，或者是自己的体系结构层次中
  - 为不同国籍、不同能力的用户定制不同的界面
- 一些用户发起的命令需要体系结构的支持
- 一些系统发起的活动要求系统维护一个环境模型

### 商业目标

开发成本和产品上市时间最小化

策略：

- 购买 or 开发
- 最初的开发成本 or 维护成本（提早交付 or 易于维护）
- 新的技术 or 已知的技术

## 体系结构的评估和改进

### 故障树分析

构造故障树（倒置的树），列出从结果到原因的逻辑路径，然后并根据选择的设计策略，将这些树用于故障改正或容错【和数字电路相同，有与门、或门】

每个节点代表一个**独立**的事件

### 割集树

当故障树过于复杂或难以视觉分析的情况下，割集树就非常有用。它揭示了哪些事件的组合可以引起失效。

**构造割集树的规则**：

1. 给割集树的顶点分配节点，使得该节点与故障树顶部的第一个逻辑门相对应
2. 自顶向下地进行，按以下步骤扩展割集树
   - 扩展或门节点得到两个子节点，分别是或门的两个子节点
   - 扩展与门节点得到一个合成的节点，由与门的两个子节点组合而成
   - 扩展组合节点中的一个逻辑门产生节点，并把该组合节点中的其他逻辑门传播到各子节点中去
3. 持续进行，直到所有的子节点都是基本事件节点或者基本事件的合成节点

**割集**是割集树中子节点的集合，表示了引起树顶失效所需的事件的最小集合

### 安全性分析

六个步骤：

1. 软件特征化
   对系统的目标以及实现方式有了比较完整的理解
2. 威胁分析
   寻找威胁的来源、威胁活动
3. 漏洞评估
   漏洞的原因不仅仅是错误，也可能是由多义性、依赖性或者拙劣的错误处理引起的
4. 风险可能性决策
   对每个漏洞都要检查它暴露的可能性大小，需要考虑四个问题：动机（即某人或系统为什么具有威胁性）；威胁利用漏洞的能力；漏洞暴露的影响（即破坏性有多大，破坏遗留的时间会持续多久，以及是通过谁）；当前控制可以抵制漏洞暴露的程度
5. 风险影响决策
   级别最高的是业务终止性的；低一级别的是损害性的；再下一级别是可恢复的；最低级别的影响是妨碍
6. 风险缓解计划
   为降低最严重的风险的可能性和后果做计划

### 权衡分析

- 一个规格说明，多个设计
- 比较表
  - 包含重要质量属性的表
  - 表的每一行表示一个质量属性
  - 表的每一列表示一种设计风格
  - `-`表示没有该特性，`+`表示有该特性
  - 接着为质量属性排优先级，然后每个设计标记满意度，相乘后相加

### 成本效益分析

用来估计和比较提议的改变所带来的成本和效益

1. 计算效益

   限定在一段时间内

2. 计算投资回报 ROI
   ROI = 效益 / 成本

   投资回收期：在累积的效益抵消实现时消耗成本之前的时间长度

### 原型化

## 文档化软件体系结构

SAD需包含以下信息：

- 系统综述：系统的主要功能和用途
- 视图：每个视图都从某个特定的角度传达了关于系统整体设计结构的信息；还应当包括视图之间的联系
- 软件单元：还应该包括它们的接口的精确规格说明
- 分析数据和结果：关于系统体系结构、计算资源和执行环境的充分信息
- 设计合理性
- 定义、术语表

并且必须定义文档的版本号或者发行日期（确定使用了同一版本，并且是最新的）

**建立视图间的映射**

**文档化设计合理性**，概述在构建设计的过程中所考虑的关键问题以及做出的权衡

## 体系结构设计评审

**确认（validating）：** 确认设计是否符合客户指定的所有需求

**验证（verification）：** 涉及保证设计是否遵循了良好的设计原则，且该设计的文档是否适合用户的需要；又分为**主动设计评审**（在SAD中发现问题）和**被动评审过程**（在阅读文档时发现问题）重点是发现错误而不是改正错误

## 软件产品线

开发一系列相关产品的成本和工作量会远远小于单独开发这些产品的总和

**产品线**

**产品系列**

**核心资产库：** 一个系列的共性（可复用资源的集合【需求、设计、代码和测试用例等】）

**战略范围**
